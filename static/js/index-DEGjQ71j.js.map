{"version":3,"file":"index-DEGjQ71j.js","sources":["../../../src/utils/axios.ts","../../../src/api/user.ts","../../../src/views/userOne/index.vue"],"sourcesContent":["import axios from 'axios'\r\nimport { ElMessage } from 'element-plus'\r\nimport useStore from '../store/index'\r\nimport router from '../router/index'\r\nconst apiUrl = import.meta.env.VITE_API_URL\r\nconst service = axios.create({\r\n    baseURL: apiUrl,\r\n    timeout: 5000,\r\n})\r\n// 请求拦截器\r\nservice.interceptors.request.use(\r\n    (config) => {\r\n        const { user } = useStore()\r\n        // token添加\r\n        console.log('====================================')\r\n        console.log(user.getToken)\r\n        console.log('====================================')\r\n        if (user.getToken) {\r\n            // // token超时\r\n            // if (isCheckTimeOut()) {\r\n            //   // 执行退出操作\r\n            //   store.dispatch('user/logout')\r\n            //   return Promise.reject(new Error('token失效'))\r\n            // }\r\n            config.headers.Authorization = `Bearer ${user.getToken}`\r\n            console.log(config, 'config')\r\n        }\r\n        return config\r\n    },\r\n    (error) => {\r\n        return Promise.reject(error)\r\n    }\r\n)\r\n// 响应拦截器\r\nservice.interceptors.response.use(\r\n    // 请求成功\r\n    async (response) => {\r\n        const { success, message, data } = response.data // 根据实际情况定制\r\n        // 判断请求是否成功\r\n        // 成功后返回解析后的数据\r\n        // 失败提供消息提示\r\n        if (success) {\r\n            return Promise.resolve(data)\r\n        } else {\r\n            ElMessage.error(message)\r\n            return Promise.reject(new Error(message))\r\n        }\r\n    },\r\n    // 请求失败\r\n    (error) => {\r\n        const { user } = useStore()\r\n        // 服务端token过期处理\r\n        if (\r\n            error.response &&\r\n            error.response.data &&\r\n            error.response.data.code === 401\r\n        ) {\r\n            user.outLogin()\r\n            router.replace('/login')\r\n        }\r\n        ElMessage.error(error.message)\r\n        return Promise.reject(error)\r\n    }\r\n)\r\nexport default service\r\n","import axios from '@/utils/axios'\r\n\r\n/**\r\n * 测试post\r\n */\r\nexport const getUserTest = (data: any) => {\r\n    return axios.post('/ddd', {\r\n        value: data,\r\n    })\r\n}\r\n\r\n/**\r\n * 测试get\r\n */\r\nexport const getUser = (data: any) => {\r\n    return axios.get('/sss')\r\n}\r\n","<template>\r\n    <div>\r\n        <el-button v-domDirective=\"['login']\" @click=\"postUser\">axios调用</el-button>\r\n        <el-button @click=\"show\">函数式组件</el-button>\r\n    </div>\r\n</template>\r\n<script lang='ts' setup>\r\nimport { ref, getCurrentInstance } from 'vue'\r\nimport { getUserTest, getUser } from '../../api/user'\r\nconst { proxy } = getCurrentInstance();\r\nconst postUser = () => {\r\n    getUser(123).then(res => {\r\n\r\n    })\r\n}\r\nconst show = () => {\r\n    console.log(proxy)\r\n    proxy.$ShowMessage({\r\n        message: '消息',\r\n        ok: () => {\r\n            console.log('确定干啥')\r\n        },\r\n        cancel: () => {\r\n            console.log('取消要干什么')\r\n        }\r\n    })\r\n}\r\ntype Props = {\r\n}\r\nconst props = withDefaults(defineProps<Props>(), {\r\n})\r\n\r\n</script>\r\n<style lang='scss' scoped></style>"],"names":["service","axios","create","baseURL","timeout","interceptors","request","use","config","user","useStore","console","log","getToken","headers","Authorization","error","Promise","reject","response","async","success","message","data","resolve","ElementPlus","ElMessage","Error","code","outLogin","router","replace","proxy","Vue","getCurrentInstance","postUser","get","then","res","show","$ShowMessage","ok","cancel"],"mappings":"+CAIA,MACAA,EAAAC,MAAAC,OAAA,CAA6BC,QAD7B,qCAEaC,QAAA,MAIbJ,EAAAK,aAAAC,QAAAC,KAA6BC,IAEf,MAAAC,KAAAA,GAAAC,IAeC,OAbPC,QAAAC,IAAA,wCACQD,QAAAC,IAAAH,EAAAI,UACRF,QAAAC,IAAA,wCACAH,EAAAI,WAOIL,EAAAM,QAAAC,cAAA,UAAAN,EAAAI,WACQF,QAAAC,IAAAJ,EAAA,WAELA,CAAA,IACXQ,GAEWC,QAAAC,OAAAF,KAIfhB,EAAAK,aAAAc,SAAAZ,KAA8Ba,MAAAD,IAGtB,MAAAE,QAAAA,EAAAC,QAAAA,EAAAC,KAAAA,GAAAJ,EAAAI,KAIA,OAAAF,EACWJ,QAAAO,QAAAD,IAEPE,YAAAC,UAAAV,MAAAM,GACAL,QAAAC,OAAA,IAAAS,MAAAL,IAAwC,IAEhDN,IAGU,MAAAP,KAAAA,GAAAC,IAWC,OARHM,EAAAG,UAAAH,EAAAG,SAAAI,MAAA,MAAAP,EAAAG,SAAAI,KAAAK,OAIAnB,EAAAoB,WACAC,EAAAC,QAAA,WAEMN,YAAAC,UAAAV,MAAAA,EAAAM,SACHL,QAAAC,OAAAF,EAAA,IC/CF,qDCLb,MAAAgB,MAAAA,GAAkBC,IAAmBC,qBACrCC,EAAA,KDKWlC,EAAMmC,IAAI,QCJjBC,MAAAC,IAAA,GAAyB,EAI7BC,EAAA,KACI5B,QAAAC,IAAAoB,GACAA,EAAAQ,aAAA,CAAmBlB,QAAA,KACNmB,GAAA,KAEL9B,QAAAC,IAAA,OAAA,EACJ8B,OAAA,KAEI/B,QAAAC,IAAA,SAAA,GACJ"}